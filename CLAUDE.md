# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

FlashBack USB is a desktop application for managing USB drive inventory. Built with Electron + Svelte 5 + MySQL, it helps IT technicians track, assign, and repurpose USB drives across different platforms and versions.

## Development Commands

```bash
npm run dev          # Start development (Vite + Electron with live reload)
npm run build        # Build frontend for production
npm run package      # Build and package with electron-builder
npm run package:win  # Build Windows NSIS installer
```

## Architecture

### Frontend-Backend Communication
- Frontend (Svelte) communicates with backend (Electron main process) via IPC
- All IPC handlers are in `electron/main.cjs`
- Frontend calls are made through `src/lib/api.js` which wraps `window.electronAPI`
- Context isolation is enabled; preload script (`electron/preload.cjs`) exposes specific APIs

### Frontend Structure (src/)
- **Svelte 5 with runes** (`$state`, `$derived`) - not Svelte 4 syntax
- **Stores** (`src/lib/stores/`): session, navigation, filters, theme, toast
- **Views** (`src/views/`): Page components organized by domain (usb-drives, technicians, platforms, etc.)
- **Components** (`src/lib/components/`): Reusable UI components
- **Routing**: Custom store-based navigation, not a router library

### Backend Structure (electron/)
- `main.cjs`: Electron main process with all IPC handlers organized by domain
- `services/`: Specialized services (database, PDF generation, QR codes, USB ID generation)
- Uses CommonJS (`.cjs` extension required for Electron compatibility)

### Database
- MySQL 8.4+ with connection pooling (`mysql2/promise`)
- Schema: `schema.sql`
- Key relationships: Platforms → USB Types → Versions → USB Drives
- USB IDs use sequential format A001-Z999 (generated by `usbIdGenerator.cjs`)
- Event logs table is append-only (audit trail)

## Key Patterns

### Adding a New IPC Handler
1. Add handler in `electron/main.cjs` using `ipcMain.handle('channel-name', ...)`
2. Expose in `electron/preload.cjs` via contextBridge
3. Add wrapper function in `src/lib/api.js`

### Adding a New View
1. Create component in `src/views/[domain]/`
2. Add route case in `App.svelte`
3. Add navigation item in `src/lib/components/Sidebar.svelte`

### Svelte 5 Reactivity
```javascript
// Stores use $state rune
let value = $state(initialValue);
let computed = $derived(expression);
```

### Styling
- TailwindCSS with DaisyUI component classes
- Theme switching via DaisyUI's `data-theme` attribute
- 30+ themes available

## Domain Logic

### USB Drive Lifecycle
- Statuses: `assigned`, `pending_update`, `damaged`, `lost`, `retired`
- Setting a version as "current" marks older drives as `pending_update`
- `legacy_valid` versions don't trigger update notifications
- Repurposing a drive: changes platform/type/version and resets assignment

### Cascade Updates
When a new "current" version is set:
1. Previous current version becomes non-current
2. All drives on older versions get `pending_update` status
3. Pending Updates view shows drives needing attention

Always use context7 when I need code generation, setup or configuration steps, or
library/API documentation. This means you should automatically use the Context7 MCP
tools to resolve library id and get library docs without me having to explicitly ask.
